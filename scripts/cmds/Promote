module.exports = {
  config: {
    name: "promote",
    version: "1.0",
    author: "Samir",
    description: "Commande pour se faire promouvoir admin par le bot",
    usage: "[promote @mention ou uid]",
    cooldown: 30,
    permissions: [2] // Seuls les admins du bot peuvent utiliser cette commande
  },

  onStart: async function({ api, event, args, message, threadsData }) {
    const { threadID, messageID, senderID, mentions } = event;
    const botAdmins = global.GoatBot.config.adminBot || [];

    // VÃ©rifier si l'utilisateur est un admin du bot
    if (!botAdmins.includes(senderID)) {
      return api.sendMessage(
        "âŒ Vous n'avez pas la permission d'utiliser cette commande",
        threadID,
        messageID
      );
    }

    // RÃ©cupÃ©rer l'ID cible
    let targetID;
    if (Object.keys(mentions).length > 0) {
      targetID = Object.keys(mentions)[0];
    } else if (args[0]) {
      targetID = args[0];
    } else {
      targetID = senderID; // Se promouvoir soi-mÃªme si aucune cible spÃ©cifiÃ©e
    }

    try {
      // VÃ©rifier si le bot est admin
      const threadInfo = await api.getThreadInfo(threadID);
      const isBotAdmin = threadInfo.adminIDs.some(admin => admin.id == api.getCurrentUserID());

      if (!isBotAdmin) {
        return api.sendMessage(
          "âŒ Le bot doit Ãªtre administrateur pour effectuer cette action",
          threadID,
          messageID
        );
      }

      // Promouvoir l'utilisateur
      await api.changeAdminStatus(threadID, targetID, true);
      
      const name = mentions[targetID] || targetID;
      api.sendMessage(
        `âœ… ${name} a Ã©tÃ© promu administrateur avec succÃ¨s`,
        threadID,
        messageID
      );

      // Journalisation
      const logThreadID = global.GoatBot.config.logGroupID;
      if (logThreadID) {
        api.sendMessage(
          `ğŸ“Œ Promotion admin effectuÃ©e par ${senderID}\n` +
          `â€¢ Groupe: ${threadInfo.name || threadID}\n` +
          `â€¢ Nouvel admin: ${targetID}`,
          logThreadID
        );
      }

    } catch (error) {
      console.error("Erreur promotion admin:", error);
      api.sendMessage(
        "âŒ Une erreur s'est produite lors de la promotion",
        threadID,
        messageID
      );
    }
  }
};
